-- Emirshah PVP GUI | V1

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- GUI Setup
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.Name = "EmirshahPVPGUI"

local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 270, 0, 240)
Frame.Position = UDim2.new(0.5, -135, 0.5, -120)
Frame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true
Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 6)

local Title = Instance.new("TextLabel", Frame)
Title.Size = UDim2.new(1, -40, 0, 30)
Title.Position = UDim2.new(0, 10, 0, 0)
Title.Text = "Emirshah PVP GUI | V1"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.BackgroundTransparency = 1
Title.Font = Enum.Font.GothamBold
Title.TextSize = 16
Title.TextXAlignment = Enum.TextXAlignment.Left

local Close = Instance.new("TextButton", Frame)
Close.Size = UDim2.new(0, 25, 0, 25)
Close.Position = UDim2.new(1, -30, 0, 2)
Close.Text = "X"
Close.BackgroundColor3 = Color3.fromRGB(180, 0, 0)
Close.TextColor3 = Color3.fromRGB(255, 255, 255)
Close.Font = Enum.Font.SourceSansBold
Close.TextSize = 16
Close.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)

-- Button Function Creator
local function createButton(name, posY)
	local button = Instance.new("TextButton", Frame)
	button.Size = UDim2.new(1, -20, 0, 30)
	button.Position = UDim2.new(0, 10, 0, posY)
	button.Text = name
	button.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	button.TextColor3 = Color3.fromRGB(255, 255, 255)
	button.Font = Enum.Font.Gotham
	button.TextSize = 14
	return button
end

local hitboxBtn = createButton("Enable Hitbox", 40)
local hitboxBox = Instance.new("TextBox", Frame)
hitboxBox.Size = UDim2.new(1, -20, 0, 25)
hitboxBox.Position = UDim2.new(0, 10, 0, 75)
hitboxBox.Text = "10"
hitboxBox.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
hitboxBox.TextColor3 = Color3.fromRGB(255, 255, 255)
hitboxBox.Font = Enum.Font.Gotham
hitboxBox.TextSize = 14

local espBtn = createButton("Enable ESP", 110)
local tracerBtn = createButton("Enable Tracer", 145)

-- Hitbox Logic
local hitboxEnabled = false
hitboxBtn.MouseButton1Click:Connect(function()
	hitboxEnabled = not hitboxEnabled
	hitboxBtn.Text = hitboxEnabled and "Disable Hitbox" or "Enable Hitbox"

	if hitboxEnabled then
		RunService:BindToRenderStep("HitboxUpdate", Enum.RenderPriority.Camera.Value, function()
			for _, plr in pairs(Players:GetPlayers()) do
				if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
					local hrp = plr.Character.HumanoidRootPart
					local size = tonumber(hitboxBox.Text) or 10
					hrp.Size = Vector3.new(size, size, size)
					hrp.Transparency = 0.3
					hrp.Color = Color3.fromRGB(255, 50, 50)
					hrp.Material = Enum.Material.ForceField
				end
			end
		end)
	else
		RunService:UnbindFromRenderStep("HitboxUpdate")
		for _, plr in pairs(Players:GetPlayers()) do
			if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
				local hrp = plr.Character.HumanoidRootPart
				hrp.Size = Vector3.new(2, 2, 1)
				hrp.Transparency = 1
				hrp.Material = Enum.Material.Plastic
			end
		end
	end
end)

-- ESP
local espEnabled = false
local tracerEnabled = false
local espBoxes = {}
local tracerLines = {}

local function createESP(plr)
	local box = Drawing.new("Square")
	box.Thickness = 1
	box.Transparency = 1
	box.Filled = false
	box.Color = Color3.new(1, 1, 1)
	espBoxes[plr] = box

	local line = Drawing.new("Line")
	line.Thickness = 1
	line.Transparency = 1
	line.Color = Color3.fromRGB(255, 255, 0)
	tracerLines[plr] = line
end

local function removeESP(plr)
	if espBoxes[plr] then espBoxes[plr]:Remove() espBoxes[plr] = nil end
	if tracerLines[plr] then tracerLines[plr]:Remove() tracerLines[plr] = nil end
end

Players.PlayerRemoving:Connect(removeESP)

espBtn.MouseButton1Click:Connect(function()
	espEnabled = not espEnabled
	espBtn.Text = espEnabled and "Disable ESP" or "Enable ESP"
end)

tracerBtn.MouseButton1Click:Connect(function()
	tracerEnabled = not tracerEnabled
	tracerBtn.Text = tracerEnabled and "Disable Tracer" or "Enable Tracer"
end)

for _, plr in pairs(Players:GetPlayers()) do
	if plr ~= LocalPlayer then createESP(plr) end
end

Players.PlayerAdded:Connect(function(plr)
	if plr ~= LocalPlayer then
		plr.CharacterAdded:Connect(function()
			wait(1)
			createESP(plr)
		end)
	end
end)

RunService.RenderStepped:Connect(function()
	for plr, box in pairs(espBoxes) do
		if plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") and plr.Character:FindFirstChild("Humanoid") and plr.Character.Humanoid.Health > 0 then
			local pos, onScreen = Camera:WorldToViewportPoint(plr.Character.HumanoidRootPart.Position)
			if onScreen and espEnabled then
				local size = Vector2.new(60, 100)
				box.Size = size
				box.Position = Vector2.new(pos.X - size.X / 2, pos.Y - size.Y / 2)
				box.Visible = true
			else
				box.Visible = false
			end

			local line = tracerLines[plr]
			if onScreen and tracerEnabled then
				line.From = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y)
				line.To = Vector2.new(pos.X, pos.Y)
				line.Visible = true
			else
				line.Visible = false
			end
		else
			box.Visible = false
			if tracerLines[plr] then tracerLines[plr].Visible = false end
		end
	end
end)
